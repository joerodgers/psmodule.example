$sb = [System.Text.StringBuilder]::new()


$null = $sb.AppendLine( "# auto generated by src\build\Compile-ModuleManefest.ps1 on $(Get-Date)")
$null = $sb.AppendLine()

$classes = Get-ChildItem -Path $PSScriptRoot\..\psmodule.example\private\classes\*.ps1

foreach( $class in $classes )
{
    $content = Get-Content -Path $class.FullName -Raw

    $null = $sb.AppendLine( "# class file - src\psmodule.example\private\classes\$($class.Name)" )
    $null = $sb.AppendLine( $content )

    $null = $sb.AppendLine()
}

$privatefunction = @'

# private function import
foreach ($function in (Get-ChildItem "$PSScriptRoot\private" -Filter "*.ps1" -Recurse -ErrorAction Ignore | Sort-Object -Property FullName ))
{
    Write-Verbose "Importing private file: '$($function.FullName)'"

    . $function.FullName
}

'@

$publicfunction = @'

# public function import
foreach ($function in (Get-ChildItem "$PSScriptRoot\public" -Filter "*.ps1" -Recurse -ErrorAction Ignore | Sort-Object -Property FullName ))
{
    Write-Verbose "Importing public file: '$($function.FullName)'"

    . $function.FullName
}

'@

$null = $sb.AppendLine( $privatefunction )
$null = $sb.AppendLine( $publicfunction )

$sb.ToString() | Set-Content -Path "$PSScriptRoot\..\psmodule.example\psmodule.example.psm1"
